---
import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Icon } from 'astro-icon/components';
import { Image } from 'astro:assets';
import blockHatLogo from '../imgs/Blockhat-logo.png';
import sekeraLogo from '../imgs/Sekera-logo.png';
import oracleLogo from '../imgs/Oracle-logo.png';

const experiencesData = [
    {
        company: "Oracle R&D Center",
        url: "https://www.oracle.com/",
        position: "DevSecOps Engineer",
        type: "Internship",
        logo: oracleLogo,
        location: "Casablanca, Morocco",
        period: "Feb 2025 - Aug 2025",
        responsibilities: [
            { text: "Developing and implementing an internal compliance and security solution for applications hosted on Oracle Cloud Infrastructure (OCI), focusing on cost optimization and efficient cloud resource management", icon: "lucide:shield-check" },
            { text: "Setting up analysis and monitoring tools to identify cost optimization opportunities in cloud environments, including detection of underutilized resources and non-optimal configurations", icon: "lucide:line-chart" },
            { text: "Collaborating with international teams to establish best practices for security and cost optimization in the OCI cloud, while ensuring compliance with security standards", icon: "lucide:users-2" }
        ]
    },
    {
        company: "Koveria Group",
        url: "https://koveriagroup.com/",
        position: "Full-Stack Developer (R&D Project)",
        type: "Freelance",
        logo: "https://i2.wp.com/koveriagroup.com/wp-content/uploads/2019/02/koveria_logo_bat.jpg?fit=2452%2C1685&ssl=1",
        location: "Belgium",
        period: "January 2025",
        responsibilities: [
            { text: "Development of IoT mobile application with secure architecture and robust authentication mechanisms", icon: "lucide:smartphone" },
            { text: "Design and deployment of scalable backend with secure REST APIs and strict data validation", icon: "lucide:server" },
        ]
    },
    {
        company: "BlockHat",
        url: "https://blockhat.io/",
        position: "Web/Web3 Developer",
        type: "Part-time",
        logo: blockHatLogo,
        location: "Casablanca, Morocco",
        period: "Mar 2023 - Jan 2025",
        responsibilities: [
            { text: "Developed and maintained web and blockchain applications using Web3 technologies", icon: "lucide:code-2" },
            { text: "Collaborated with cross-functional teams to integrate blockchain solutions into web platforms", icon: "lucide:users" }
        ]
    },
    {
        company: "SEKERA",
        url: "https://sekera-group.com/",
        position: "Cyber Security Engineer",
        type: "Internship",
        logo: sekeraLogo,
        location: "Casablanca, Morocco",
        period: "Jun 2023 - Aug 2023",
        responsibilities: [
            { text: "Conducted Infrastructure penetration tests, identifying and documenting vulnerabilities", icon: "lucide:shield" },
            { text: "Engineered Docker containers to simulate diverse web security scenarios, enhancing testing effectiveness", icon: "lucide:box" },
            { text: "Developed custom scripts to automate vulnerability scanning processes", icon: "lucide:file-code-2" }
        ]
    }
];
---

<section id="experience" class="py-16">
    <h3 class="text-4xl font-bold mb-10 text-foreground">Experience</h3>
    <div class="space-y-5">
        {experiencesData.map((exp, index) => (
                <Card className="bg-gradient-to-br from-background to-muted/30 rounded-2xl shadow-lg border overflow-hidden transition-all duration-300 hover:shadow-xl group">
                    <div class="flex flex-col sm:flex-row items-center sm:items-stretch">
                        <div class="flex-shrink-0 w-full sm:w-auto sm:flex-grow-0 p-5 flex items-center justify-center bg-muted/20 rounded-l-2xl rounded-r-none sm:rounded-r-2xl">
                            <a href={exp.url} target="_blank" rel="noopener noreferrer" aria-label={`Visit ${exp.company} website`} class="transition-transform duration-300 hover:scale-105">
                                <Image
                                        src={exp.logo}
                                        alt={`${exp.company} logo`}
                                        width={72}
                                        height={72}
                                        class="w-16 h-16 sm:w-18 sm:h-18 rounded-xl object-contain bg-white p-2 shadow-sm"
                                />
                            </a>
                        </div>
                        <CardContent className="flex-grow p-5 flex flex-col sm:flex-row sm:items-center justify-between w-full">
                            <div class="flex-grow">
                                <div class="mb-3">
                                    <h4 class="text-xl font-semibold text-foreground font-alt mb-1">
                                        <a href={exp.url} target="_blank" rel="noopener noreferrer" class="hover:underline hover:text-primary transition-colors">
                                            {exp.company}
                                        </a>
                                    </h4>
                                    <p class="text-base text-foreground/85 font-alt mb-2">{exp.position}</p>
                                    <span class="inline-block px-3 py-1 text-xs font-medium bg-primary/10 text-primary rounded-full border border-primary/20">
                                        {exp.type}
                                    </span>
                                </div>
                                <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                                    <div class="flex items-center text-sm text-foreground/65">
                                        <Icon name="lucide:map-pin" class="w-4 h-4 mr-2 text-primary/70" />
                                        <span>{exp.location}</span>
                                    </div>
                                    <div class="flex items-center text-sm text-foreground/65">
                                        <Icon name="lucide:calendar" class="w-4 h-4 mr-2 text-primary/70" />
                                        <span>{exp.period}</span>
                                    </div>
                                </div>
                            </div>
                            <button class="responsibilities-toggle mt-4 sm:mt-0 text-primary hover:text-primary/80 transition-all duration-300 self-end bg-primary/10 hover:bg-primary/20 rounded-full p-3 hover:scale-105 group-hover:shadow-lg" data-index={index} aria-label="Toggle responsibilities">
                                <Icon name="lucide:chevron-down" class="w-5 h-5 transition-transform duration-300 ease-in-out" />
                            </button>
                        </CardContent>
                    </div>
                    <div class="responsibilities-content hidden" data-index={index}>
                        <div class="bg-gradient-to-br from-muted/25 to-muted/15 border-t border-muted/30">
                            <CardContent className="p-5">
                                <h5 class="text-base font-semibold text-foreground mb-4 flex items-center gap-2">
                                    <Icon name="lucide:list-checks" class="w-4 h-4 text-primary" />
                                    Key Responsibilities
                                </h5>
                                <div class="grid gap-3">
                                    {exp.responsibilities.map((task) => (
                                            <div class="flex items-start p-3 bg-background/60 rounded-xl transition-all duration-300 hover:bg-primary/5 hover:shadow-sm group/item">
                                                <div class="bg-primary/10 p-2 rounded-full mr-3 mt-0.5 group-hover/item:bg-primary/20 transition-colors duration-300">
                                                    <Icon name={task.icon} class="w-4 h-4 text-primary" />
                                                </div>
                                                <p class="text-sm text-foreground/80 flex-1 leading-relaxed">{task.text}</p>
                                            </div>
                                    ))}
                                </div>
                            </CardContent>
                        </div>
                    </div>
                </Card>
        ))}
    </div>
</section>

<style>
    .responsibilities-content {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease-out;
    }
    .responsibilities-content.expanded {
        max-height: 800px;
        opacity: 1;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease-in;
    }

    /* Prevent layout shift during toggle */
    .responsibilities-toggle {
        min-width: 44px;
        min-height: 44px;
    }

    /* Ensure stable height for responsibility items */
    .responsibilities-content .grid > div {
        min-height: 60px;
    }
</style>

<script>
    document.addEventListener('astro:page-load', () => {
        const toggles = document.querySelectorAll('.responsibilities-toggle');
        toggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                const index = toggle.getAttribute('data-index');
                const content = document.querySelector(`.responsibilities-content[data-index="${index}"]`);
                const icon = toggle.querySelector('svg');

                if (content && icon) {
                    content.classList.toggle('expanded');
                    content.classList.toggle('hidden');
                    icon.style.transform = content.classList.contains('expanded') ? 'rotate(180deg)' : 'rotate(0deg)';
                }
            });
        });
    });
</script>